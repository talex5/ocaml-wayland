<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Zwp_linux_dmabuf_v1 (wayland.Wayland_protocols.Linux_dmabuf_unstable_v1_server.Zwp_linux_dmabuf_v1)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">wayland</a> &#x00BB; <a href="../../index.html">Wayland_protocols</a> &#x00BB; <a href="../index.html">Linux_dmabuf_unstable_v1_server</a> &#x00BB; Zwp_linux_dmabuf_v1</nav><header class="odoc-preamble"><h1>Module <code><span>Linux_dmabuf_unstable_v1_server.Zwp_linux_dmabuf_v1</span></code></h1><p>Factory for creating dmabuf-based wl_buffers.</p><p>Following the interfaces from: https://www.khronos.org/registry/egl/extensions/EXT/EGL_EXT_image_dma_buf_import.txt https://www.khronos.org/registry/EGL/extensions/EXT/EGL_EXT_image_dma_buf_import_modifiers.txt and the Linux DRM sub-system's AddFb2 ioctl.</p><p>This interface offers ways to create generic dmabuf-based wl_buffers.</p><p>Clients can use the get_surface_feedback request to get dmabuf feedback for a particular surface. If the client wants to retrieve feedback not tied to a surface, they can use the get_default_feedback request.</p><p>The following are required from clients:</p><ul><li>Clients must ensure that either all data in the dma-buf is coherent for all subsequent read access or that coherency is correctly handled by the underlying kernel-side dma-buf implementation.</li></ul><ul><li>Don't make any more attachments after sending the buffer to the compositor. Making more attachments later increases the risk of the compositor not being able to use (re-import) an existing dmabuf-based wl_buffer.</li></ul><p>The underlying graphics stack must ensure the following:</p><ul><li>The dmabuf file descriptors relayed to the server will stay valid for the whole lifetime of the wl_buffer. This means the server may at any time use those fds to import the dmabuf into any kernel sub-system that might accept it.</li></ul><p>However, when the underlying graphics stack fails to deliver the promise, because of e.g. a device hot-unplug which raises internal errors, after the wl_buffer has been successfully created the compositor must not raise protocol errors to the client when dmabuf import later fails.</p><p>To create a wl_buffer from one or more dmabufs, a client creates a zwp_linux_dmabuf_params_v1 object with a zwp_linux_dmabuf_v1.create_params request. All planes required by the intended format are added with the 'add' request. Finally, a 'create' or 'create_immed' request is issued, which has the following outcome depending on the import success.</p><p>The 'create' request,</p><ul><li>on success, triggers a 'created' event which provides the final wl_buffer to the client.</li><li>on failure, triggers a 'failed' event to convey that the server cannot use the dmabufs received from the client.</li></ul><p>For the 'create_immed' request,</p><ul><li>on success, the server immediately imports the added dmabufs to create a wl_buffer. No event is sent from the server in this case.</li><li>on failure, the server can choose to either:</li><li>terminate the client by raising a fatal error.</li><li>mark the wl_buffer as failed, and send a 'failed' event to the client. If the client uses a failed wl_buffer as an argument to any request, the behaviour is compositor implementation-defined.</li></ul><p>For all DRM formats and unless specified in another protocol extension, pre-multiplied alpha is used for pixel values.</p><p>Unless specified otherwise in another protocol extension, implicit synchronization is used. In other words, compositors and clients must wait and signal fences implicitly passed via the DMA-BUF's reservation mechanism.</p><p>Disclaimer: This protocol extension has been marked stable. This copy is no longer used and only retained for backwards compatibility. The canonical version can be found in the stable/ directory.</p></header><nav class="odoc-toc"><ul><li><a href="#version-1,-2">Version 1, 2</a></li><li><a href="#version-3">Version 3</a></li><li><a href="#version-4,-5">Version 4, 5</a></li><li><a href="#handlers">Handlers</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'v t</span></span><span> = <span><span>(<span>[ `Zwp_linux_dmabuf_v1 ]</span>, <span class="type-var">'v</span>, <span>[ `Server ]</span>)</span> <a href="../../../Wayland/Proxy/index.html#type-t">Wayland.Proxy.t</a></span></span></code></div></div><h3 id="version-1,-2"><a href="#version-1,-2" class="anchor"></a>Version 1, 2</h3><div class="odoc-spec"><div class="spec value anchored" id="val-format"><a href="#val-format" class="anchor"></a><code><span><span class="keyword">val</span> format : <span><span><span>[&lt; `V1 <span>| `V2</span> <span>| `V3</span> <span>| `V4</span> <span>| `V5</span> ]</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">format</span>:int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Supported buffer format.</p><p>This event advertises one buffer format that the server supports. All the supported formats are advertised once when the client binds to this interface. A roundtrip after binding guarantees that the client has received all supported formats.</p><p>For the definition of the format codes, see the zwp_linux_buffer_params_v1::create request.</p><p>Starting version 4, the format event is deprecated and must not be sent by compositors. Instead, use get_default_feedback or get_surface_feedback.</p></div></div><h3 id="version-3"><a href="#version-3" class="anchor"></a>Version 3</h3><div class="odoc-spec"><div class="spec value anchored" id="val-modifier"><a href="#val-modifier" class="anchor"></a><code><span><span class="keyword">val</span> modifier : 
  <span><span><span>[&lt; `V3 <span>| `V4</span> <span>| `V5</span> ]</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">format</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">modifier_hi</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">modifier_lo</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Supported buffer format modifier.</p><p>This event advertises the formats that the server supports, along with the modifiers supported for each format. All the supported modifiers for all the supported formats are advertised once when the client binds to this interface. A roundtrip after binding guarantees that the client has received all supported format-modifier pairs.</p><p>For legacy support, DRM_FORMAT_MOD_INVALID (that is, modifier_hi == 0x00ffffff and modifier_lo == 0xffffffff) is allowed in this event. It indicates that the server can support the format with an implicit modifier. When a plane has DRM_FORMAT_MOD_INVALID as its modifier, it is as if no explicit modifier is specified. The effective modifier will be derived from the dmabuf.</p><p>A compositor that sends valid modifiers and DRM_FORMAT_MOD_INVALID for a given format supports both explicit modifiers and implicit modifiers.</p><p>For the definition of the format and modifier codes, see the zwp_linux_buffer_params_v1::create and zwp_linux_buffer_params_v1::add requests.</p><p>Starting version 4, the modifier event is deprecated and must not be sent by compositors. Instead, use get_default_feedback or get_surface_feedback.</p></div></div><h3 id="version-4,-5"><a href="#version-4,-5" class="anchor"></a>Version 4, 5</h3><h3 id="handlers"><a href="#handlers" class="anchor"></a>Handlers</h3><p>Note: Servers will always want to use <code>v1</code>.</p><div class="odoc-spec"><div class="spec class anchored" id="class-v1"><a href="#class-v1" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span> +'a </span><span><a href="class-v1/index.html">v1</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Handler for a proxy with version &gt;= 1.</p></div></div><div class="odoc-spec"><div class="spec class anchored" id="class-v2"><a href="#class-v2" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span> +'a </span><span><a href="class-v2/index.html">v2</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Handler for a proxy with version &gt;= 2.</p></div></div><div class="odoc-spec"><div class="spec class anchored" id="class-v3"><a href="#class-v3" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span> +'a </span><span><a href="class-v3/index.html">v3</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Handler for a proxy with version &gt;= 3.</p></div></div><div class="odoc-spec"><div class="spec class anchored" id="class-v4"><a href="#class-v4" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span> +'a </span><span><a href="class-v4/index.html">v4</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Handler for a proxy with version &gt;= 4.</p></div></div><div class="odoc-spec"><div class="spec class anchored" id="class-v5"><a href="#class-v5" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span> +'a </span><span><a href="class-v5/index.html">v5</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Handler for a proxy with version &gt;= 5.</p></div></div></div></body></html>
