<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Msg (wayland.Wayland.Msg)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v2.3.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">wayland</a> &#x00BB; <a href="../index.html">Wayland</a> &#x00BB; Msg</nav><header class="odoc-preamble"><h1>Module <code><span>Wayland.Msg</span></code></h1><p>Building and parsing messages.</p></header><nav class="odoc-toc"><ul><li><a href="#reading-messages">Reading messages</a></li><li><a href="#generating-messages">Generating messages</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'rw) t</span></span><span> <span class="keyword">constraint</span> <span class="type-var">'rw</span> = <span>[&lt; `R <span>| `W</span> ]</span></span></code></div><div class="spec-doc"><p>An <code>('a, 'rw) t</code> is a message for the <code>'a</code> interface. <code>'rw</code> is <code>`R</code> for an incoming message to be read, or <code>`W</code> for an outgoing message to be written.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_args"><a href="#val-pp_args" class="anchor"></a><code><span><span class="keyword">val</span> pp_args : <span><span><a href="../Metadata/index.html#type-arg">Metadata.arg</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_args types</code> is a formatter for messages with argument types <code>types</code>.</p></div></div><h3 id="reading-messages"><a href="#reading-messages" class="anchor"></a>Reading messages</h3><div class="odoc-spec"><div class="spec value anchored" id="val-parse"><a href="#val-parse" class="anchor"></a><code><span><span class="keyword">val</span> parse : 
  <span><span class="label">fds</span>:<span><span class="xref-unresolved">Unix</span>.file_descr <span class="xref-unresolved">Stdlib</span>.Queue.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span>[ `R ]</span>)</span> <a href="#type-t">t</a></span> option</span></span></code></div><div class="spec-doc"><p><code>parse ~fds buf</code> returns the first message in <code>buf</code>, if any. When <code>get_fd</code> is called, it will take one from <code>fds</code>. Returns <code>None</code> if <code>buf</code> does not contain a complete message.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj"><a href="#val-obj" class="anchor"></a><code><span><span class="keyword">val</span> obj : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p><code>obj t</code> is the object ID in the message header.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-op"><a href="#val-op" class="anchor"></a><code><span><span class="keyword">val</span> op : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>op t</code> is the operation ID in the message header.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-length"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>length t</code> is the total size of the message (including any space for arguments not yet added).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_int"><a href="#val-get_int" class="anchor"></a><code><span><span class="keyword">val</span> get_int : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p><code>get_int t</code> returns the next argument (which must be an integer) from <code>t</code> and advances the next-argument pointer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_string"><a href="#val-get_string" class="anchor"></a><code><span><span class="keyword">val</span> get_string : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>get_string t</code> returns the next argument (which must be a string) from <code>t</code> and advances the next-argument pointer. The string returned does not include the trailing <code>'\0'</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_string_opt"><a href="#val-get_string_opt" class="anchor"></a><code><span><span class="keyword">val</span> get_string_opt : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p><code>get_string_opt t</code> returns the next argument (which must be a string or NULL) from <code>t</code> and advances the next-argument pointer. The string returned does not include the trailing <code>'\0'</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_array"><a href="#val-get_array" class="anchor"></a><code><span><span class="keyword">val</span> get_array : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>get_array t</code> returns the next argument (which must be array) from <code>t</code> and advances the next-argument pointer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_fd"><a href="#val-get_fd" class="anchor"></a><code><span><span class="keyword">val</span> get_fd : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></div><div class="spec-doc"><p><code>get_fd t</code> takes the next FD from the queue. It raises an exception if the queue is empty. Note that the Wayland protocol does not indicate which FDs below to which messages, so if used incorrectly this will remove FDs intended for other messages. The caller takes ownership of the FD and is responsible for closing it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_fixed"><a href="#val-get_fixed" class="anchor"></a><code><span><span class="keyword">val</span> get_fixed : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../Fixed/index.html#type-t">Fixed.t</a></span></code></div><div class="spec-doc"><p><code>get_fixed t</code> returns the next argument (which must be a fixed-point number) from <code>t</code> and advances the next-argument pointer.</p></div></div><h3 id="generating-messages"><a href="#generating-messages" class="anchor"></a>Generating messages</h3><div class="odoc-spec"><div class="spec value anchored" id="val-alloc"><a href="#val-alloc" class="anchor"></a><code><span><span class="keyword">val</span> alloc : 
  <span><span class="label">obj</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">op</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ints</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">strings</span>:<span><span>string option</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">arrays</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>See <a href="../Proxy/index.html#val-alloc"><code>Proxy.alloc</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_int"><a href="#val-add_int" class="anchor"></a><code><span><span class="keyword">val</span> add_int : <span><span><span>(<span class="type-var">_</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_string"><a href="#val-add_string" class="anchor"></a><code><span><span class="keyword">val</span> add_string : <span><span><span>(<span class="type-var">_</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_string_opt"><a href="#val-add_string_opt" class="anchor"></a><code><span><span class="keyword">val</span> add_string_opt : <span><span><span>(<span class="type-var">_</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>string option</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_array"><a href="#val-add_array" class="anchor"></a><code><span><span class="keyword">val</span> add_array : <span><span><span>(<span class="type-var">_</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_fd"><a href="#val-add_fd" class="anchor"></a><code><span><span class="keyword">val</span> add_fd : <span><span><span>(<span class="type-var">_</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>add_fd t fd</code> adds a copy of <code>fd</code> (made with <code>Unix.dup</code>) to the message.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_fixed"><a href="#val-add_fixed" class="anchor"></a><code><span><span class="keyword">val</span> add_fixed : <span><span><span>(<span class="type-var">_</span>, <span>[ `W ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Fixed/index.html#type-t">Fixed.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>
